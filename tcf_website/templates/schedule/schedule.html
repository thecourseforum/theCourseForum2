{% load static %}

<div id="schedule{{schedule.id}}" class="schedule card mb-2">
    <div class="card-body text-left">
        <div class="row">
            <!-- schedule Main Content -->
            <div class="schedule-body col-xs-12 col-md-12 col-lg-12">
                {{schedule.name}}
                <p id="ScheduleRating-{{mode}}">Schedule rating: {{rating|floatformat:2}}</p>
                <p id="ScheduleDifficulty-{{mode}}">Schedule difficulty: {{difficulty|floatformat:2}}</p>
                <p id="ScheduleCredits-{{mode}}">Credits: {{credits}}</p>

                <ul id="schedule_courses-{{schedule.id}}" class="schedule_card_courses">
                    {% for course in courses %}
                        <li>
                            <div id="ScheduledCourse-{{course.id}}{{mode}}" class="schedule_course_card">
                                <h6 class="schedule_course_card_header">{{course}}</h6>
                                <div class="schedule_course_card_content">
                                    {{course.user}}
                                    <div>
                                        {{course.instructor}}
                                    </div>
                                    <div>
                                        {{course.section}}
                                    </div>
                                    <div>
                                        {{course.time}}
                                    </div>
                                    <div>
                                        {{course.section.section_type}}
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% empty %}
                        <p>You have no classes!</p>
                    {% endfor %}

                </ul>
            </div>
        </div>
    </div>
</div>

{% block js %}
<script type="text/javascript">

var compiled_schedule = [];
function makeSerialSchedule() {
    // this method is called from other templates, and it populates the compiled_schedule array with the course times
    // there is a potential improvement to use the courses context variable instead of pulling from the html

    const parent = document.getElementById("schedule_courses-{{schedule.id}}");
    const courseCards = parent.querySelectorAll('.schedule_course_card');
    let times = [];

    // if there are no courses for the schedule, return early
    if (!courseCards) {return;}

    courseCards.forEach(card => {
        // Assuming the time is always in the third div inside the card
        const timeDiv = card.querySelector('.schedule_course_card_content > div:nth-child(3)');
        if (timeDiv) {
            const timeString = timeDiv.textContent.trim();
    
            // add to time string array
            times.push(timeString);
        }
    });
    compiled_schedule = consolidateTimes(times);
    
}

function checkConflictWrapper(newTime) {
    // this function should always be called after making the serialized schedule
    if(! compiled_schedule){
        // this condition either means the schedule is empty or this function was improperly called.
        return false;
    }
    // call checkConflict(), which is located in the parse_time.js static file
    res = checkConflict(newTime, compiled_schedule);
    return res;
}


</script>
{% endblock %}