{% extends "v2/base.html" %}
{% load static %}

{% block title %}My Profile | theCourseForum{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/v2/pages/profile.css' %}">
{% endblock %}

{% block content %}

<div class="profile-page">
  <h1 class="profile-page__title">My Profile</h1>
  
  <div class="profile-card">
    <div class="profile-card__header">
      <img 
        src="{% static 'base/img/alderman-and-peabody.jpg' %}" 
        alt="UVA Library" 
        class="profile-card__header-image"
      >
    </div>
    
    <div class="profile-card__body">
      <form method="POST" action="{% url 'profile_v2' %}" id="profile-form">
        {% csrf_token %}
        
        <section class="form-section">
          <h2 class="form-section__title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            My Details
          </h2>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="id_first_name" class="form-group__label">First Name</label>
              {{ form.first_name }}
              <span class="form-group__hint">Your name is never public.</span>
            </div>
            
            <div class="form-group">
              <label for="id_last_name" class="form-group__label">Last Name</label>
              {{ form.last_name }}
            </div>
            
            <div class="form-group">
              <label for="id_graduation_year" class="form-group__label">Graduation Year</label>
              {{ form.graduation_year }}
            </div>
          </div>
        </section>
        
        <div class="button-group">
          <button type="submit" class="btn-primary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Save Profile
          </button>
          
          <button type="button" class="btn-danger" data-action="delete-profile">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Delete Profile
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" id="delete-profile-modal">
  <div class="modal__backdrop"></div>
  <div class="modal__container">
    <div class="modal__header">
      <h2 class="modal__title">Delete Profile</h2>
      <button class="modal__close" data-action="close-modal" aria-label="Close modal">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div class="modal__body">
      <div class="delete-warning">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <div class="delete-warning__text">
          <strong>This action cannot be undone.</strong> All of your reviews and data will be permanently deleted.
        </div>
      </div>
      
      <p>Are you sure you want to delete your profile?</p>
    </div>
    
    <div class="modal__footer">
      <button class="btn btn--secondary" data-action="close-modal">Cancel</button>
      <form method="POST" action="{% url 'delete_profile' user.id %}">
        {% csrf_token %}
        <input type="hidden" name="next" value="{% url 'browse_v2' %}">
        <button type="submit" class="btn-danger">Yes, Delete My Profile</button>
      </form>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Delete profile modal
const deleteBtn = document.querySelector('[data-action="delete-profile"]');
const deleteModal = document.getElementById('delete-profile-modal');

if (deleteBtn && deleteModal) {
  deleteBtn.addEventListener('click', () => {
    deleteModal.classList.add('is-open');
    document.body.style.overflow = 'hidden';
  });
  
  deleteModal.querySelectorAll('[data-action="close-modal"]').forEach(btn => {
    btn.addEventListener('click', () => {
      deleteModal.classList.remove('is-open');
      document.body.style.overflow = '';
    });
  });
  
  deleteModal.querySelector('.modal__backdrop').addEventListener('click', () => {
    deleteModal.classList.remove('is-open');
    document.body.style.overflow = '';
  });
}
</script>
{% endblock %}
