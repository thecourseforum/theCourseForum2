{% extends "base/base.html" %}
{% load static %}

{% block title %}Write a Review - theCourseForum{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'reviews/new_review.css' %}" />
{% endblock %}

{% block content %}
<div class="new-review container-fluid d-flex flex-column text-left mx-md-5 mx-sm-4">

    <h2 class="mt-2 mb-4">Write a review</h2>
    <div class="row">
    <div class="card col">

    <form class="card-body" action="{% url 'new_review' %}" method="POST">
        {% csrf_token %}
        <!-- Class Info -->
        <div class="new-review-course form-row mb-3">
          <h4 class="review-form-header form-group col-12 my-4">
            Which class are you reviewing?</h4>
          <div class="form-group col-sm-3 col-6">
            <label for="subject">Subject</label>
            <select type="text" class="form-control" required
                    id="subject" name="subject" onchange=loadCourseData()>
              <option value="NONE" disabled selected>[Select]</option>
              <!-- {% for s in subjects %}
              <option value={{s}}>{{s}}</option>
              {% endfor %} -->
            </select>
          </div>
          <div class="form-group col-sm-3 col-6">
            <label for="courseID">Course ID</label>
            <select type="text" class="form-control" required
                    id="courseID" name="courseID" onchange=loadInstructorData()>
              <option value="NONE" disabled selected>[Select]</option>
              <!-- {% for c in courseIDs %}
              <option value={{c}}>{{c}}</option>
              {% endfor %} -->
            </select>
          </div>
          <div class="form-group col-sm-6">
            <label for="instructor">Instructor</label>
            <select type="text" class="form-control" required
                    id="instructor" name="instructor">
              <option value="NONE" disabled selected>[Select]</option>
              <!-- {% for i in instructors %}
              <option value={{i}}>{{i}}</option>
              {% endfor %} -->
            </select>
          </div>
        </div>
        <div class="form-row mb-3">
          <div class="form-group col-sm-3 col-6">
            <label for="semester">Semester</label>
            <select type="text" class="form-control" id="semester" name="semester" required>
              <option value="" disabled selected>[Select]</option>
              <option value="Fall">Fall</option>
              <option value="January">January</option>
              <option value="Spring">Spring</option>
              <option value="Summer">Summer</option>
            </select>
          </div>
          <div class="form-group col-sm-3 col-6">
            <label for="year">Year</label>
            <select type="text" class="form-control" id="year" name="year" required>
              <option value="" disabled selected>[Select]</option>
              <option value="2016">2016</option>
              <option value="2017">2017</option>
              <option value="2018">2018</option>
              <option value="2019">2019</option>
              <option value="2020">2020</option>
              <option value="2021">2021</option>
            </select>
          </div>
        </div>
        <hr>

        <!-- Review written content -->
        <div class="new-review-content form-row mb-3">
          <h4 class="review-form-header form-group col-12 my-4">
            Tell us more about the course and instructor</h4>
          <div class="form-group col mb-3">
            <textarea class="form-control" id="reviewText" name="reviewText" rows="5"
                      placeholder="e.g. I love CS 2150, Bloomfield is great!"></textarea>
          </div>
        </div>
        <hr>

        <!-- Review ratings for course -->
        <div class="new-review-ratings form-row mb-3">
          <div class="form-group col-sm-6 pr-sm-5">
              <h4 class="review-form-header col-12 p-0 my-4">
                Rate the course</h4>
              <div class="mt-3">
                  <label for="instructorRating" class="review-form-label">
                    <i class="fas fa-user"></i> Instructor
                  </label>
                  <div class="d-flex">
                      <span class="mr-2">1</span>
                      <input type="range" class="custom-range" min="1" max="5" step="1"
                             value=3 id="instructorRating" name="instructorRating" required>
                      <span class="ml-2">5</span>
                  </div>
              </div>
              <div class="mt-3">
                  <label for="instructorRating" class="review-form-label">
                    <i class="far fa-smile-beam"></i> Enjoyability
                  </label>
                  <div class="d-flex">
                      <span class="mr-2">1</span>
                      <input type="range" class="custom-range" min="1" max="5" step="1"
                             value=3 id="enjoyability" name="enjoyability" required>
                      <span class="ml-2">5</span>
                  </div>
              </div>
              <div class="mt-3">
                  <label for="difficulty" class="review-form-label">
                    <i class="fas fa-dumbbell"></i> Difficulty
                  </label>
                  <div class="d-flex">
                      <span class="mr-2">1</span>
                      <input type="range" class="custom-range" min="1" max="5" step="1"
                             value=3 id="difficulty" name="difficulty" required>
                      <span class="ml-2">5</span>
                  </div>
              </div>
              <div class="mt-3">
                  <label for="recommendability" class="review-form-label">
                    <i class="fas fa-thumbs-up"></i> Recommendability
                  </label>
                  <div class="d-flex">
                      <span class="mr-2">1</span>
                      <input type="range" class="custom-range" min="1" max="5" step="1"
                             value=3 id="recommendability" name="recommendability" required>
                      <span class="ml-2">5</span>
                  </div>
              </div>
          </div>
          <div class="form-group col-sm-6 px-sm-4">
              <h4 class="review-form-header p-0 mt-4">
                Hours of work/week</h4>
              <div class="row py-3">
                <label for="hoursReading" class="review-form-label col-8">
                  <i class="fas fa-book"></i> Reading
                </label>
                <input type="number" value=0 min="0" max="20" class="form-control col"
                       id="hoursReading" name="hoursReading" required>
              </div>
              <div class="row py-3">
                <label for="hoursWriting" class="review-form-label col-8">
                  <i class="fas fa-pencil-alt"></i> Writing
                </label>
                <input type="number" value=0 min="0" max="20" class="form-control col"
                       id="hoursWriting" name="hoursWriting" required>
              </div>
              <div class="row py-3">
                <label for="hoursGroupwork" class="review-form-label col-8">
                  <i class="fas fa-user-friends"></i> Groupwork
                </label>
                <input type="number" value=0 min="0" max="20" class="form-control col"
                       id="hoursGroupwork" name="hoursGroupwork" required>
              </div>
              <div class="row py-3">
                <label for="hoursOther" class="review-form-label col-8">
                  <i class="fas fa-flask"></i> Other
                </label>
                <input type="number" value=0 min="0" max="20" class="form-control col"
                       id="hoursOther" name="hoursOther" required>
              </div>
          </div>
        </div>
        <hr>
        <div class="new-review-submit row my-4">
          <button type="submit" class="btn btn-primary mx-auto">Submit Review</button>
        </div>

        <select type="text" class="form-control" id="country" name="country" required>
          <option value="" disabled selected>[Select]</option>
          <option value="Germany">Germany</option>
          <option value="Spain">Spain</option>
        </select>
        <select type="text" onchange=loadInstructorData() class="form-control" id="location" name="location" required>
          <option value="" disabled selected>[Select]</option>
        </select>
      </form>
    </div>
</div>
</div>

{% endblock %}

{% block js %}
<script type="text/javascript">
  // Executed when DOM is ready
  jQuery(function($) {
    // Fetch all subdepartment data from API
    var endpoint = 'http://localhost:8000/api/subdepartments/'
    $.getJSON(endpoint, function(data) {
        // Generate option tags
        var optionTags = $.map(data, function(subdept){
            return '<option value="' + subdept.id + '">' + subdept.mnemonic + '</option>'
        }).join('');
        // Prepend default option
        optionTags = '<option value="" disabled selected>[Select]</option>' + optionTags

        // Add option tags to select element in html
        $('#subject').html(optionTags)

        return this;
    });
  });

  function loadCourseData() {
    var subdeptID = $('#subject').val()
    console.log(subdeptID);

    // Fetch course data from API, based on selected subdepartment
    var pageSizeParam = '&page_size=1000'
    var endpoint = 'http://localhost:8000/api/courses/?subdepartment=' + subdeptID + pageSizeParam
    $.getJSON(endpoint, function(data) {
        console.log(data);
        // Generate option tags
        var optionTags = $.map(data.results, function(course){
            // 4-digit courseIDs only
            if(course.number > 1000)
                return '<option value="' + course.id + '">' + course.number + '</option>'
        }).join('');
        // Prepend default option
        optionTags = '<option value="" disabled selected>[Select]</option>' + optionTags

        // Add option tags to select element in html
        $('#courseID').html(optionTags)

        return this;
    });
  }

  function loadInstructorData() {
    var courseID = $('#courseID').val()
    console.log(courseID);

    // Fetch instructor data from API, based on selected course
    var pageSizeParam = '&page_size=1000'
    var endpoint = 'http://localhost:8000/api/instructors/?section__course=' + courseID + pageSizeParam
    $.getJSON(endpoint, function(data) {
        console.log(data);
        // Generate option tags
        var optionTags = $.map(data.results, function(instr){
            return '<option value="' + instr.id + '">' + instr.first_name +
                   ' ' + instr.last_name + '</option>'
        }).join('');
        // Prepend default option
        optionTags = '<option value="" disabled selected>[Select]</option>' + optionTags

        // Add option tags to select element in html
        $('#instructor').html(optionTags)

        return this;
    });
  }
</script>
{% endblock %}
