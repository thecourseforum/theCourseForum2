{% extends "base/base.html" %}
{% load static %}

{% block title %}{{ course.code }} Study Guide | theCourseForum{% endblock %}

{% block page_metadata %}
{% if course_code %}<meta name="course-code" content="{{ course_code }}">{% endif %}
{% if course_title %}<meta name="course-title" content="{{ course_title }}">{% endif %}
{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'common/show-hide.css' %}"/>
{% endblock %}

{% block content %}
<div class="container">
  <div class="container-lg mb-4">
    {% include "../common/leaderboard_ad.html" with ad_slot="9533576562" %}
  </div>
  <div class="container-lg">
    {% include "common/toolbar.html" with breadcrumbs=breadcrumbs sorting=False %}
  </div>

  <div class="container-lg mt-3 px-0">
    <div class="d-md-flex align-items-baseline my-3">
      <h1 class="mr-md-3 text-nowrap">{{ course.code }}</h1>
      <h2>Study Guide</h2>
      <div class="ml-sm-auto d-flex justify-content-end">
        <a class="ml-2 mt-2 btn btn-outline-primary" href="{% url 'course' mnemonic=course.subdepartment.mnemonic course_number=course.number %}">
          <i class="fas fa-arrow-left" aria-hidden="true"></i> Back to Course
        </a>
      </div>
    </div>

    <!-- Call-to-action to upload on a dedicated page, emphasized inside a white card -->
    <div class="jumbotron py-4 px-4 mb-4">
      <div class="d-flex justify-content-center">
        <div class="bg-white rounded shadow-sm w-100 p-4 d-flex flex-column flex-md-row align-items-center" style="min-height: 140px;">
          <div class="flex-grow-1 d-flex flex-column justify-content-center">
            <h4 class="mb-2">Have helpful notes, exams, or study materials?</h4>
            <p class="mb-0">Share them with the community to help future students.</p>
          </div>
          <div class="mt-3 mt-md-0">
            <a class="btn btn-lg bg-tcf-orange text-white" href="{% url 'study_guide_upload' mnemonic=course.subdepartment.mnemonic course_number=course.number %}">
              <i class="fas fa-upload" aria-hidden="true"></i> Upload your own documents
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header bg-tcf-indigo text-white d-flex align-items-center justify-content-between">
        <h4 class="mb-0">Documents</h4>
        {% if active_tag %}
          <span class="badge badge-light">Filtered by: {{ active_tag }}</span>
        {% endif %}
      </div>
      <div class="card-body">
        <div class="mt-2">
          {% if documents|length == 0 %}
            <p class="mb-2">No documents uploaded yet for this course.</p>
            <p>
              Be the first to share study resources.
            </p>
          {% else %}
            <ul class="list-group">
              {% for d in documents %}
                <li class="list-group-item">
                  <div class="d-flex align-items-center">
                    <div class="mr-3" style="width: 90px; max-width: 90px;">
                      {% if d.mime_type and d.mime_type|slice:":6" == "image/" %}
                        <img src="{{ d.file.url }}" alt="Preview" class="img-thumbnail" style="max-height: 80px; object-fit: cover;" />
                      {% elif d.mime_type == "application/pdf" %}
                        <img src="{% static 'icons/img/fa-book.svg' %}" alt="PDF" class="img-fluid" style="max-height: 80px;" />
                      {% else %}
                        <img src="{% static 'icons/img/fa-book.svg' %}" alt="Document" class="img-fluid" style="max-height: 80px;" />
                      {% endif %}
                    </div>
                    <div class="flex-grow-1 d-flex justify-content-between align-items-center">
                      <div>
                        <strong>{{ d.title }}</strong>
                        {% if d.description %}<div class="text-muted">{{ d.description }}</div>{% endif %}
                        <div class="small text-muted">
                          Uploaded {{ d.created_at|date:"M j, Y" }}{% if d.uploader %} by {{ d.uploader.username }}{% endif %}
                          {% if d.size %} â€¢ {{ d.size }} bytes{% endif %}
                        </div>
                        {% if d.tags.exists %}
                          <div class="mt-1">
                            {% for t in d.tags.all %}
                              <a class="badge badge-secondary mr-1" href="?tag={{ t.name }}">{{ t.name }}</a>
                            {% endfor %}
                          </div>
                        {% endif %}
                      </div>
                      <div>
                        <a class="btn btn-sm btn-outline-primary" href="{{ d.file.url }}" target="_blank">View</a>
                      </div>
                    </div>
                  </div>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
 </div>
{% endblock %}

{% block js %}
  <script type="module" src="{% static 'common/bind-show-hide.js' %}"></script>
{% endblock %}