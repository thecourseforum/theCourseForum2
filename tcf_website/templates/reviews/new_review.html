{% extends "base/base.html" %}
{% load static %}

{% block title %}Write a Review - theCourseForum{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'reviews/new_review.css' %}" />
{% endblock %}

{% block content %}

<div class="new-review container text-left mx-auto">
  <h1 class="h2 mt-2 mb-4">Write a review</h1>
  <div class="card">
    <form class="card-body px-md-5" id="reviewForm" action="{% url 'new_review' %}" method="POST">
        {% csrf_token %}
        {% include 'reviews/review_form_content.html' %}
        <div class="new-review-submit row py-4">
          <button type="submit" class="btn btn-primary mx-auto" id="submitBtn">Submit Review</button>
        </div>
    </form>
  </div>
</div>

{% endblock %}

{% block js %}
<script type="text/javascript" src="{% static 'reviews/new_review.js' %}"></script>
<script type="text/javascript" src="{% static 'reviews/sync_review_sliders.js' %}"></script>
<script src="jquery-3.5.1.min.js"></script>
<script>
  // For Bootstrap tooltip
  $(function () {
    $('[data-toggle="tooltip"]').tooltip()
  });

  $('#submitBtn').on('click', function(e) {
        var submit = true;

        $.ajax({
            type: 'POST',
            url: '/reviews/new',
            dataType: "json",
            data: $("#reviewForm").serialize(),
            async: false,
            success: function(json) {
                if(json.duplicate) {
                    alert("You have already submitted a review for this course!");
                    submit = false;
                }
            }
        });

        if(submit) {
            document.getElementById("submitBtn").style = 'hidden';
            setTimeout(function () { reenableButton(); }, 3000);
        }

        return submit;
  });

  function reenableButton() {
        // Sets button back to initial state
        document.getElementById("submitBtn").disabled = false;
        return true;
  }

</script>
{% endblock %}
