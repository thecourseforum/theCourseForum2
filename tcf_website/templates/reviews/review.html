{% load static %}
<link rel="stylesheet" href="{% static 'reviews/review.css' %}" />

<div id="review{{review.id}}" class="review card mb-2">
    <div class="card-body text-left">
        <div class="row">
            <!-- Review upvote/downvote panel -->
            <div class="vote-container col-2 col-lg-1 d-none d-md-flex flex-column justify-content-center align-items-center">
                <!--Voting logic is implemented in the <script> tag of reviews.html-->
                <a class="upvote {% if review.user_vote == 1 %}active{% endif %}" href="{% url 'login' %}" id="upvote{{review.id}}">
                    <i class="fa fa-angle-up fa-fw"></i>
                </a>
                <span id="vote-count" class="voteCount">{{ review.sum_votes }}</span>
                <a class="downvote {% if review.user_vote == -1 %}active{% endif %}" href="{% url 'login' %}" id="downvote{{review.id}}">
                    <i class="fa fa-angle-down fa-fw"></i>
                </a>
            </div>

            <!-- Review Main Content -->
            <div class="review-body col-xs-12 col-md-10 col-lg-11">

                <!-- Review header content (subject, actions, text) -->
                {% if profile %}
                <!-- Subject and Edit/Delete actions show only on profile page -->
                <div class="review-header">
                    <div class="d-flex">
                        <div class="review-subject">
                          <a href="{% url 'course_instructor' course_id=review.course.pk instructor_id=review.instructor.pk %}">
                              <h5><b>{{ review.course }}</b> â€” {{ review.instructor.full_name }}</h5>
                          </a>
                        </div>
                        <div class="review-actions ml-auto">
                          <!-- Edit functionality is TBD -->
                          <!-- <a class="review-edit btn btn-sm btn-primary" href="#">
                              <i class="fas fa-pencil-alt"></i> Edit
                          </a> -->
                          <button class="review-delete btn btn-sm btn-outline-danger" type="button"
                                  data-toggle="modal" data-target="#deleteReviewModal{{review.id}}">
                            <i class="fa fa-trash-o"></i> Delete
                          </button>
                          {% include "reviews/delete_confirm_modal.html" with review_id=review.id %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <div class="review-content">
                  <p class="card-text mb-2" style="white-space: pre-line;">{{ review.text }}</p>
                </div>

                <div class="review-footer row mt-3">
                    <!-- Review Ratings -->
                    <div class="review-ratings col-sm-8 d-flex align-items-end">
                        <div class="d-flex text-center flex-wrap mb-2">
                            <div id="review-average" class="font-weight-bold">
                                <i class="fa fa-star fa-fw"></i>
                                {{ review.average|floatformat:2 }}
                            </div>
                            <div class="ml-4 text-muted">
                                <i class="fas fa-thumbs-up"></i>
                                {{ review.recommendability }}
                            </div>
                            <div class="ml-4 text-muted">
                                <i class="fa fa-user"></i>
                                {{ review.instructor_rating }}
                            </div>
                            <div class="ml-4 text-muted">
                                <i class="far fa-smile-beam"></i>
                                {{ review.enjoyability }}
                            </div>
                            <div class="ml-4 text-muted">
                                <i class="fa fa-dumbbell fa-fw"></i>
                                {{ review.difficulty }}
                            </div>
                            <div class="ml-4 text-muted">
                                <i class="fa fa-hourglass-half fa-fw"></i>
                                {{ review.hours_per_week }}
                            </div>
                        </div>
                    </div>

                    <div class="review-date col-sm-4 pl-0 text-right text-tcf-orange">
                        <h6 class="font-weight-bold">{{ review.semester }}</h6>
                        <h6 id="date">Updated {{ review.created|date }}</h6>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { handleVote } from "{% static 'reviews/review.js' %}";
    {% if user.is_authenticated %}
        $('.upvote').each(function(i, obj) {
            $(this).click(()=>{
                handleVote(obj.id.substring(6), true);
            });
            $(this).removeAttr('href');
        });
        $('.downvote').each(function(i, obj) {
            $(this).click(()=>{
                handleVote(obj.id.substring(8), false);
            });
            $(this).removeAttr('href');
        });
    {% endif %}
</script>
